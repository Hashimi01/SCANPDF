#!/bin/bash
# ุณูุฑูุจุช ุดุงูู ูุฅุนุงุฏุฉ ูุญุต ุงููุชุจ ุงููุฑูุณูุฉ
# ููุชู ุฌููุน ุงูุนูููุงุช ุงูุฌุงุฑูุฉ ุซู ูุณุชุฎุฑุฌ ุงููุชุจ ุงููุฑูุณูุฉ

echo "======================================================================"
echo "๐ซ๐ท ุฅุนุงุฏุฉ ูุญุต ุงููุชุจ ุงููุฑูุณูุฉ - ุณูุฑูุจุช ุดุงูู"
echo "======================================================================"

# 1. ูุชู ุฌููุน ุฌูุณุงุช screen
echo ""
echo "๐ ุฌุงุฑู ุฅููุงุก ุฌููุน ุฌูุณุงุช screen..."
screen -X quit 2>/dev/null || true
sleep 2

# ูุชู ุนูููุงุช tesseract ู ocrmypdf
echo "๐ ุฌุงุฑู ุฅููุงุก ุนูููุงุช OCR..."
pkill -9 tesseract 2>/dev/null || true
pkill -9 ocrmypdf 2>/dev/null || true
sleep 1

# 2. ุงูุงูุชูุงู ูููุฌูุฏ
echo ""
echo "๐ ุงูุงูุชูุงู ุฅูู /root/i2pdf..."
cd /root/i2pdf || exit 1

# 3. ุชุญุฏูุซ ุงููุดุฑูุน
echo ""
echo "๐ฅ ุฌุงุฑู ุชุญุฏูุซ ุงููุดุฑูุน ูู GitHub..."
git pull

# 4. ุชูุนูู venv
echo ""
echo "๐ ุชูุนูู Python virtual environment..."
source venv/bin/activate

# 5. ุงุณุชุฎุฑุงุฌ ุงููุชุจ ุงููุฑูุณูุฉ ูู ุงูููู
echo ""
echo "======================================================================"
echo "๐ ุงุณุชุฎุฑุงุฌ ุงููุชุจ ุงููุฑูุณูุฉ ูู ุงูููู..."
echo "======================================================================"
python extract_french_books.py

# 6. ุฌูุจ ุงููุชุจ ุงููุฑูุณูุฉ ูู MongoDB
echo ""
echo "======================================================================"
echo "๐ ุฌูุจ ุงููุชุจ ุงููุฑูุณูุฉ ูู MongoDB..."
echo "======================================================================"
python recheck_french_books.py

echo ""
echo "======================================================================"
echo "โ ุงูุชููุช ุฌููุน ุงูุนูููุงุช!"
echo "======================================================================"
echo ""
echo "๐ ุงููููุงุช ุงูููุดุฃุฉ:"
echo "   - french_books.json (ูู ุงูููู ุงูุฃุตูู)"
echo "   - french_books_to_recheck.json (ูู MongoDB)"
echo ""
echo "๐ก ููููู ุงูุขู ุงุณุชุฎุฏุงู ูุฐู ุงููููุงุช ููุญุต ุงููุชุจ ุงููุฑูุณูุฉ"

